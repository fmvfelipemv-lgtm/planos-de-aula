<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano de Aula Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }
        .floating-item {
            animation: float-1 6s ease-in-out infinite;
        }
        .floating-item-2 {
            animation: float-2 8s ease-in-out infinite;
            animation-delay: 2s;
        }
        .floating-item-3 {
            animation: float-3 7s ease-in-out infinite;
            animation-delay: 1s;
        }
        @keyframes float-1 {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(15px, -20px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes float-2 {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-10px, 25px) rotate(-8deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes float-3 {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(20px, -15px) rotate(10deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .loader {
            border-top-color: #8B5CF6;
            animation: spinner 1.5s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .info-header {
            font-size: 1.5rem;
            font-weight: 800;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-900 dark:to-gray-800 overflow-y-auto flex items-center justify-center p-4 relative">

    <div class="absolute top-10 left-5 text-9xl transform -rotate-12 floating-item">✏️</div>
    <div class="absolute top-1/4 right-5 text-9xl transform rotate-12 floating-item-2">📎</div>
    <div class="absolute bottom-10 left-1/4 text-9xl transform rotate-6 floating-item-3">📏</div>
    <div class="absolute bottom-20 right-10 text-9xl transform -rotate-6 floating-item">📓</div>
    <div class="absolute top-1/3 left-10 text-9xl transform -rotate-10 floating-item-2">✂️</div>
    <div class="absolute bottom-1/3 right-5 text-9xl transform rotate-5 floating-item">🎨</div>

    <div id="app-container" class="relative z-10 w-full flex items-center justify-center p-4 my-8"></div>

    <div class="absolute bottom-4 right-4 text-3xl font-bold text-gray-500 dark:text-gray-400">
        by FeMaViei
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const appContainer = document.getElementById('app-container');
            let currentPage = 'email';
            let formData = {
                subject: '',
                topic: '',
                gradeLevel: '',
                duration: '',
                objective: '',
                activities: '',
                materials: '',
                assessment: ''
            };
            let generatedPlan = '';
            let isLoading = false;
            let error = null;
            let copiedMessage = false;
            let userEmail = '';

            // Base de conhecimentos pedagógicos
            const pedagogicalKnowledge = {
                methodologies: [
                    "Aprendizagem Baseada em Projetos",
                    "Sala de Aula Invertida",
                    "Aprendizagem Cooperativa",
                    "Estudo de Caso",
                    "Aprendizagem Baseada em Problemas",
                    "Rotação por Estações",
                    "Gamificação"
                ],
                activities: {
                    fundamental1: [
                        "Rodinha de conversa sobre o tema",
                        "Produção de desenhos relacionados",
                        "Jogos educativos em grupo",
                        "Contação de histórias",
                        "Atividades com materiais concretos"
                    ],
                    fundamental2: [
                        "Debates orientados",
                        "Pesquisa em grupo",
                        "Produção de maquetes ou modelos",
                        "Seminários temáticos",
                        "Experimentação prática"
                    ],
                    medio: [
                        "Elaboração de artigos científicos",
                        "Análise crítica de textos",
                        "Projetos interdisciplinares",
                        "Simulações e role-playing",
                        "Produção de podcasts ou vídeos educativos"
                    ]
                },
                resources: [
                    "Material dourado para matemática",
                    "Mapas mentais e conceituais",
                    "Vídeos educativos do YouTube",
                    "Aplicativos educacionais",
                    "Jogos de tabuleiro educativos",
                    "Laboratório de ciências",
                    "Biblioteca de sala de aula",
                    "Recursos audiovisuais"
                ],
                assessments: [
                    "Autoavaliação dos estudantes",
                    "Portfólios de aprendizagem",
                    "Rubricas de avaliação",
                    "Listas de observação",
                    "Provas dialogadas",
                    "Relatórios de atividades",
                    "Apresentações orais",
                    "Diários de bordo"
                ]
            };

            const render = () => {
                appContainer.innerHTML = '';
                if (currentPage === 'email') {
                    renderEmailForm();
                } else if (currentPage === 'form') {
                    renderForm();
                } else {
                    renderResult();
                }
            };

            const handleInputChange = (name, value) => {
                formData = { ...formData, [name]: value };
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                isLoading = true;
                error = null;
                render();
                
                await generateLessonPlan();
            };

            const handleEmailSubmit = (e) => {
                e.preventDefault();
                const emailInput = document.getElementById('user-email');
                userEmail = emailInput.value.trim();
                
                // Validação de email
                if (!userEmail.includes('@') || !userEmail.includes('.')) {
                    error = 'Por favor, insira um email válido';
                    render();
                    return;
                }
                
                currentPage = 'form';
                render();
            };

            const generateLessonPlan = async () => {
                try {
                    // Gerar plano de aula com conhecimentos pedagógicos
                    generatedPlan = generateConsciousPlan(formData);
                    currentPage = 'result';
                    
                } catch (err) {
                    error = 'Erro ao gerar plano: ' + err.message;
                }
                isLoading = false;
                render();
            };

            const getGradeLevelGroup = (gradeLevel) => {
                if (gradeLevel.includes('1') || gradeLevel.includes('2') || gradeLevel.includes('3') || gradeLevel.includes('4') || gradeLevel.includes('5')) {
                    return 'fundamental1';
                } else if (gradeLevel.includes('6') || gradeLevel.includes('7') || gradeLevel.includes('8') || gradeLevel.includes('9')) {
                    return 'fundamental2';
                } else {
                    return 'medio';
                }
            };

            const generateConsciousPlan = (data) => {
                const { subject, topic, gradeLevel, duration } = data;
                const gradeGroup = getGradeLevelGroup(gradeLevel);
                
                // Selecionar metodologia apropriada
                const randomMethodology = pedagogicalKnowledge.methodologies[
                    Math.floor(Math.random() * pedagogicalKnowledge.methodologies.length)
                ];
                
                // Selecionar atividades apropriadas para o nível
                const gradeActivities = pedagogicalKnowledge.activities[gradeGroup];
                const selectedActivities = [];
                for (let i = 0; i < 3; i++) {
                    const randomIndex = Math.floor(Math.random() * gradeActivities.length);
                    if (!selectedActivities.includes(gradeActivities[randomIndex])) {
                        selectedActivities.push(gradeActivities[randomIndex]);
                    }
                }
                
                // Selecionar recursos
                const selectedResources = [];
                for (let i = 0; i < 4; i++) {
                    const randomIndex = Math.floor(Math.random() * pedagogicalKnowledge.resources.length);
                    if (!selectedResources.includes(pedagogicalKnowledge.resources[randomIndex])) {
                        selectedResources.push(pedagogicalKnowledge.resources[randomIndex]);
                    }
                }
                
                // Selecionar métodos de avaliação
                const selectedAssessments = [];
                for (let i = 0; i < 3; i++) {
                    const randomIndex = Math.floor(Math.random() * pedagogicalKnowledge.assessments.length);
                    if (!selectedAssessments.includes(pedagogicalKnowledge.assessments[randomIndex])) {
                        selectedAssessments.push(pedagogicalKnowledge.assessments[randomIndex]);
                    }
                }
                
                // Calcular distribuição de tempo com base na duração
                const totalMinutes = parseInt(duration);
                const introductionTime = Math.floor(totalMinutes * 0.15);
                const developmentTime = Math.floor(totalMinutes * 0.60);
                const conclusionTime = Math.floor(totalMinutes * 0.15);
                const assessmentTime = Math.floor(totalMinutes * 0.10);
                
                // Gerar objetivos específicos baseados no tema
                const specificObjectives = [
                    `Compreender os conceitos fundamentais de ${topic.toLowerCase()}`,
                    `Analisar a importância de ${topic.toLowerCase()} no contexto atual`,
                    `Aplicar os conhecimentos sobre ${topic.toLowerCase()} em situações práticas`,
                    `Desenvolver habilidades críticas em relação a ${topic.toLowerCase()}`,
                    `Relacionar ${topic.toLowerCase()} com outras áreas do conhecimento`
                ];
                
                return `**PLANO DE AULA INTELIGENTE**

**INFORMAÇÕES GERAIS**
**Disciplina:** ${subject}
**Tema Central:** ${topic}
**Série/Ano:** ${gradeLevel}
**Duração:** ${duration} minutos
**Metodologia Principal:** ${randomMethodology}

**OBJETIVOS DE APRENDIZAGEM**
• ${specificObjectives[0]}
• ${specificObjectives[1]}
• ${specificObjectives[2]}
• ${specificObjectives[3]}
• ${specificObjectives[4]}

**DESENVOLVIMENTO DA AULA**

**Introdução (${introductionTime} minutos)**
• Apresentação do tema através de uma situação-problema contextualizada
• Levantamento dos conhecimentos prévios dos estudantes
• Contextualização histórica e social do tema abordado
• Explicitação dos objetivos de aprendizagem e da metodologia

**Desenvolvimento (${developmentTime} minutos)**
• Atividade 1: ${selectedActivities[0]}
• Atividade 2: ${selectedActivities[1]}
• Atividade 3: ${selectedActivities[2]}
• Mediação do professor para garantir a compreensão dos conceitos
• Momentos de discussão em grupo para socialização das descobertas

**Recursos Didáticos**
${selectedResources.map(resource => `• ${resource}`).join('\n')}

**Conclusão (${conclusionTime} minutos)**
• Sistematização dos conhecimentos construídos durante a aula
• Reflexão coletiva sobre o processo de aprendizagem
• Relação entre o tema estudado e outros componentes curriculares
• Preparação para os próximos passos da sequência didática

**AVALIAÇÃO (${assessmentTime} minutos)**
• Critérios de avaliação:
  - Participação e engajamento nas atividades propostas
  - Qualidade das contribuições nos momentos de discussão
  - Demonstração de compreensão dos conceitos trabalhados
• Instrumentos de avaliação:
${selectedAssessments.map(assessment => `  - ${assessment}`).join('\n')}

**REFERÊNCIAS BIBLIOGRÁFICAS SUGERIDAS**
• Livros didáticos atualizados da disciplina
• Artigos científicos recentes sobre o tema
• Documentos curriculares oficiais
• Sites educacionais especializados
• Obras literárias relacionadas à temática

**OBSERVAÇÕES E ADAPTAÇÕES**
• Considerar o ritmo de aprendizagem de cada estudante
• Proporcionar diferentes formas de representação e expressão
• Oferecer materiais complementares para estudantes com dificuldades
• Propor extensões e aprofundamentos para estudantes com maior facilidade
• Manter registro das estratégias que funcionaram bem para futuro planejamento

*Plano pedagógico inteligente - ${new Date().toLocaleDateString('pt-BR')}*`;
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(generatedPlan).then(() => {
                    copiedMessage = true;
                    render();
                    setTimeout(() => {
                        copiedMessage = false;
                        render();
                    }, 2000);
                });
            };

            const handleShareWhatsApp = () => {
                const encodedText = encodeURIComponent(`Confira meu plano de aula:\n\n${generatedPlan}`);
                window.open(`https://wa.me/?text=${encodedText}`, '_blank');
            };

            const handleSavePdf = async () => {
                try {
                    const element = document.getElementById('plan-content');
                    const canvas = await html2canvas(element, {
                        scale: 2,
                        backgroundColor: '#ffffff'
                    });

                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const imgWidth = 210;
                    const pageHeight = 297;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdf.save('plano-de-aula-inteligente.pdf');
                    
                } catch (err) {
                    alert('Erro ao gerar PDF: ' + err.message);
                }
            };

            const parsePlan = (planText) => {
                const sections = [];
                const lines = planText.split('\n');
                let currentTitle = '';
                let currentContent = '';

                lines.forEach(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine.startsWith('**') && trimmedLine.endsWith('**')) {
                        if (currentTitle) {
                            sections.push({ 
                                title: currentTitle.replace(/\*\*/g, ''), 
                                content: currentContent.trim() 
                            });
                        }
                        currentTitle = trimmedLine;
                        currentContent = '';
                    } else {
                        currentContent += line + '\n';
                    }
                });

                if (currentTitle) {
                    sections.push({ 
                        title: currentTitle.replace(/\*\*/g, ''), 
                        content: currentContent.trim() 
                    });
                }

                return sections.length > 0 ? sections : [{ title: 'PLANO DE AULA', content: planText }];
            };

            const renderEmailForm = () => {
                const emailHTML = `
                    <div class="relative p-6 md:p-10 bg-white dark:bg-gray-800 rounded-3xl shadow-xl w-full max-w-2xl mx-auto space-y-6">
                        <h2 class="text-3xl font-bold text-gray-800 dark:text-white text-center mb-2">Plano de Aula Inteligente</h2>
                        <p class="text-gray-600 dark:text-gray-400 text-center mb-6">Sistema avançado de planejamento pedagógico</p>
                        
                        <form id="email-form" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">
                                    Seu email
                                </label>
                                <input 
                                    type="email" 
                                    id="user-email" 
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition" 
                                    placeholder="seu.email@exemplo.com" 
                                    required 
                                />
                                <p class="text-sm text-gray-500 mt-2">
                                    Seu email será usado para personalizar seu plano de aula.
                                </p>
                            </div>
                        </form>
                        
                        ${error ? `<div class="text-red-500 bg-red-100 p-3 rounded-lg mt-4">${error}</div>` : ''}
                        
                        <button onclick="document.getElementById('email-form').requestSubmit()" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition duration-200 mt-6">
                            Continuar para o Planejamento
                        </button>
                        
                        <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                            <h3 class="font-bold text-blue-800 dark:text-blue-300 mb-2">Como funciona?</h3>
                            <p class="text-blue-700 dark:text-blue-300 text-sm">
                                Nosso sistema utiliza conhecimentos pedagógicos consolidados para criar planos de aula 
                                inteligentes e personalizados, gerando conteúdo original com base em suas necessidades.
                            </p>
                        </div>
                    </div>
                `;
                appContainer.innerHTML = emailHTML;

                const form = document.getElementById('email-form');
                form.onsubmit = handleEmailSubmit;
            };

            const renderForm = () => {
                const formHTML = `
                    <form id="lesson-form" class="relative p-6 md:p-10 bg-white dark:bg-gray-800 rounded-3xl shadow-xl w-full max-w-2xl mx-auto space-y-6">
                        <h2 class="text-3xl font-bold text-gray-800 dark:text-white text-center mb-2">Plano de Aula Inteligente</h2>
                        <p class="text-gray-600 dark:text-gray-400 text-center mb-6">Informe os dados básicos para gerar um plano pedagógico completo</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${Object.entries({
                                subject: 'Disciplina*',
                                topic: 'Tema Central*',
                                gradeLevel: 'Série/Ano*',
                                duration: 'Duração (minutos)*'
                            }).map(([key, label]) => `
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">${label}</label>
                                    <input type="text" name="${key}" value="${formData[key]}" 
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition" required />
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-700">
                            <h3 class="font-bold text-yellow-800 dark:text-yellow-300 mb-2">💡 Como usar</h3>
                            <p class="text-yellow-700 dark:text-yellow-300 text-sm">
                                Insira apenas as informações básicas. Nosso sistema irá gerar um plano completo 
                                com objetivos, atividades, recursos e avaliações baseados em conhecimentos pedagógicos.
                            </p>
                        </div>
                        
                        ${error ? `<div class="text-red-500 bg-red-100 p-3 rounded-lg mt-4">${error}</div>` : ''}
                        
                        <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition duration-200 mt-6 flex items-center justify-center">
                            ${isLoading ? '<div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 mr-2"></div> Gerando Conteúdo Inteligente...' : 'Gerar Plano de Aula Inteligente'}
                        </button>
                    </form>
                `;
                appContainer.innerHTML = formHTML;

                const form = document.getElementById('lesson-form');
                form.onsubmit = handleSubmit;

                // Adicionar event listeners para os inputs
                form.querySelectorAll('input, textarea').forEach(input => {
                    input.oninput = (e) => handleInputChange(e.target.name, e.target.value);
                });
            };

            const renderResult = () => {
                const parsedPlan = parsePlan(generatedPlan);
                
                const resultHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-4xl mx-auto p-6">
                        <h2 class="text-3xl font-bold text-gray-800 dark:text-white text-center mb-4">PLANO DE AULA INTELIGENTE</h2>
                        
                        <div id="plan-content" class="space-y-6">
                            ${parsedPlan.map((section, index) => {
                                let customContent = section.content;
                                // Destacar informações principais na primeira seção
                                if (index === 0) {
                                    customContent = customContent.replace(/(Disciplina:|Tema Central:|Série\/Ano:|Duração:|Metodologia Principal:)/g, '<strong class="text-lg">$1</strong>');
                                }
                                
                                return `
                                <div class="p-6 rounded-xl bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-700 dark:to-gray-600 border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                                        ${index === 0 ? '📋 ' : index === 1 ? '🎯 ' : index === 2 ? '🔄 ' : index === 3 ? '📚 ' : index === 4 ? '📝 ' : '📌 '}
                                        ${section.title}
                                    </h3>
                                    <div class="text-gray-700 dark:text-gray-300 whitespace-pre-line leading-relaxed ${index === 0 ? 'info-header' : ''}">
                                        ${customContent}
                                    </div>
                                </div>
                            `}).join('')}
                        </div>
                        
                        <div class="flex flex-wrap gap-3 justify-center mt-8">
                            <button id="copy-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center">
                                📋 Copiar
                            </button>
                            <button id="whatsapp-btn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center">
                                📱 WhatsApp
                            </button>
                            <button id="pdf-btn" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center">
                                📄 PDF
                            </button>
                            <button id="back-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center">
                                ↩ Voltar
                            </button>
                        </div>
                        
                        ${copiedMessage ? '<div class="text-green-600 text-center mt-4 font-semibold animate-pulse">✓ Copiado para a área de transferência!</div>' : ''}
                        
                        <div class="mt-8 text-center text-sm text-gray-500 dark:text-gray-400">
                            <p>Plano gerado em ${new Date().toLocaleString('pt-BR')} | Sistema de Planejamento Inteligente</p>
                        </div>
                    </div>
                `;
                appContainer.innerHTML = resultHTML;

                // Adicionar event listeners corretamente
                document.getElementById('copy-btn').onclick = handleCopy;
                document.getElementById('whatsapp-btn').onclick = handleShareWhatsApp;
                document.getElementById('pdf-btn').onclick = handleSavePdf;
                document.getElementById('back-btn').onclick = () => {
                    currentPage = 'form';
                    render();
                };
            };

            render();
        });
    </script>
</body>
</html>
