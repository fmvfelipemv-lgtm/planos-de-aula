<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano de Aula</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }
        .floating-item {
            animation: float-1 6s ease-in-out infinite;
        }
        .floating-item-2 {
            animation: float-2 8s ease-in-out infinite;
            animation-delay: 2s;
        }
        .floating-item-3 {
            animation: float-3 7s ease-in-out infinite;
            animation-delay: 1s;
        }
        @keyframes float-1 {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(15px, -20px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes float-2 {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-10px, 25px) rotate(-8deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes float-3 {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(20px, -15px) rotate(10deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 overflow-y-auto flex items-center justify-center p-4 relative">

    <div class="absolute top-10 left-5 text-9xl transform -rotate-12 floating-item">✏️</div>
    <div class="absolute top-1/4 right-5 text-9xl transform rotate-12 floating-item-2">📎</div>
    <div class="absolute bottom-10 left-1/4 text-9xl transform rotate-6 floating-item-3">📏</div>
    <div class="absolute bottom-20 right-10 text-9xl transform -rotate-6 floating-item">📓</div>
    <div class="absolute top-1/3 left-10 text-9xl transform -rotate-10 floating-item-2">✂️</div>
    <div class="absolute bottom-1/3 right-5 text-9xl transform rotate-5 floating-item">🎨</div>

    <div id="app-container" class="relative z-10 w-full flex items-center justify-center p-4 my-8"></div>

    <div class="absolute bottom-4 right-4 text-3xl font-bold text-gray-500 dark:text-gray-400">
        by FeMaViei
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const appContainer = document.getElementById('app-container');
            let currentPage = 'form';
            let formData = {
                subject: '',
                topic: '',
                gradeLevel: '',
                duration: '',
                objective: '',
                activities: '',
                materials: '',
                assessment: ''
            };
            let generatedPlan = '';
            let isLoading = false;
            let error = null;
            let copiedMessage = false;

            const render = () => {
                appContainer.innerHTML = '';
                if (currentPage === 'form') {
                    renderForm();
                } else {
                    renderResult();
                }
            };

            const handleInputChange = (name, value) => {
                formData = { ...formData, [name]: value };
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                isLoading = true;
                error = null;
                render();
                
                await new Promise(resolve => setTimeout(resolve, 100));
                await generateLessonPlan();
            };

            const generateLessonPlan = async () => {
                try {
                    // Gerar plano detalhado baseado nos dados fornecidos
                    generatedPlan = generateDetailedPlan(formData);
                    currentPage = 'result';
                } catch (err) {
                    error = 'Erro ao gerar plano: ' + err.message;
                }
                isLoading = false;
                render();
            };

            const generateDetailedPlan = (data) => {
                const { subject, topic, gradeLevel, duration, objective, activities, materials, assessment } = data;
                
                return `**PLANO DE AULA COMPLETO**

**DISCIPLINA:** ${subject.toUpperCase()}
**TEMA:** ${topic}
**SÉRIE/ANO:** ${gradeLevel}
**DURAÇÃO:** ${duration} minutos (${Math.floor(duration/60)}h${duration%60}min)

**OBJETIVOS ESPECÍFICOS**
• Compreender o conceito de ${topic.toLowerCase()}
• Identificar ${topic.toLowerCase()} em diferentes contextos
• Aplicar os conhecimentos sobre ${topic.toLowerCase()} em situações práticas
• Desenvolver habilidades de análise e interpretação
• ${objective || 'Promover aprendizagem significativa'}

**RECURSOS DIDÁTICOS**
• ${materials || 'Materiais básicos de ensino'}
• Quadro branco ou negro
• Projetor multimídia (se disponível)
• Materiais impressos e apostilas
• Recursos audiovisuais complementares

**INSTRUMENTOS DE AVALIAÇÃO**
• ${assessment || 'Avaliação contínua do processo'}
• Participação nas atividades propostas
• Resolução dos exercícios práticos
• Observação do engajamento durante as explicações
• Autoavaliação dos estudantes

**REFERÊNCIAS BIBLIOGRÁFICAS**
• Livros didáticos da disciplina
• Materiais complementares específicos
• Recursos educacionais digitais
• Documentos oficiais da base curricular

**OBSERVAÇÕES**
• Ajustar o tempo conforme o ritmo da turma
• Considerar as particularidades dos estudantes
• Manter ambiente propício para aprendizagem
• Promover inclusão e participação de todos

*Plano pedagógico gerado automaticamente - ${new Date().toLocaleDateString('pt-BR')}*`;
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(generatedPlan).then(() => {
                    copiedMessage = true;
                    render();
                    setTimeout(() => {
                        copiedMessage = false;
                        render();
                    }, 2000);
                });
            };

            const handleShareWhatsApp = () => {
                const encodedText = encodeURIComponent(generatedPlan);
                window.open(`https://wa.me/?text=${encodedText}`, '_blank');
            };

            const handleSavePdf = async () => {
                try {
                    const element = document.getElementById('plan-content');
                    const canvas = await html2canvas(element, {
                        scale: 2,
                        backgroundColor: '#ffffff'
                    });

                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const imgWidth = 210;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                    pdf.save('plano-de-aula.pdf');
                    
                } catch (err) {
                    alert('Erro ao gerar PDF: ' + err.message);
                }
            };

            const parsePlan = (planText) => {
                const sections = [];
                const lines = planText.split('\n');
                let currentTitle = '';
                let currentContent = '';

                lines.forEach(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine.startsWith('**') && trimmedLine.endsWith('**')) {
                        if (currentTitle) {
                            sections.push({ 
                                title: currentTitle.replace(/\*\*/g, ''), 
                                content: currentContent.trim() 
                            });
                        }
                        currentTitle = trimmedLine;
                        currentContent = '';
                    } else {
                        currentContent += line + '\n';
                    }
                });

                if (currentTitle) {
                    sections.push({ 
                        title: currentTitle.replace(/\*\*/g, ''), 
                        content: currentContent.trim() 
                    });
                }

                return sections.length > 0 ? sections : [{ title: 'PLANO DE AULA', content: planText }];
            };

            const renderForm = () => {
                const formHTML = `
                    <form id="lesson-form" class="relative p-6 md:p-10 bg-white dark:bg-gray-800 rounded-3xl shadow-xl w-full max-w-2xl mx-auto space-y-6">
                        <h2 class="text-3xl font-bold text-gray-800 dark:text-white text-center mb-6">Plano de Aula</h2>
                        <div class="space-y-4">
                            ${Object.entries({
                                subject: 'Disciplina',
                                topic: 'Conteúdo/Tema',
                                gradeLevel: 'Série/Ano',
                                duration: 'Duração (minutos)',
                                objective: 'Objetivo(s)',
                                activities: 'Atividades',
                                materials: 'Materiais',
                                assessment: 'Avaliação'
                            }).map(([key, label]) => `
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">${label}</label>
                                    ${key === 'duration' ? `
                                        <input type="number" name="${key}" value="${formData[key]}" 
                                            class="w-full p-3 border-2 border-gray-300 rounded-lg" required />
                                    ` : key === 'objective' || key === 'activities' || key === 'materials' || key === 'assessment' ? `
                                        <textarea name="${key}" 
                                            class="w-full p-3 border-2 border-gray-300 rounded-lg min-h-[100px]">${formData[key]}</textarea>
                                    ` : `
                                        <input type="text" name="${key}" value="${formData[key]}" 
                                            class="w-full p-3 border-2 border-gray-300 rounded-lg" required />
                                    `}
                                </div>
                            `).join('')}
                        </div>
                        ${error ? `<div class="text-red-500 bg-red-100 p-3 rounded-lg mt-4">${error}</div>` : ''}
                        <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition duration-200 mt-6">
                            ${isLoading ? 'Gerando...' : 'Gerar Plano de Aula'}
                        </button>
                    </form>
                `;
                appContainer.innerHTML = formHTML;

                const form = document.getElementById('lesson-form');
                form.onsubmit = handleSubmit;

                // Adicionar event listeners para os inputs
                form.querySelectorAll('input, textarea').forEach(input => {
                    input.oninput = (e) => handleInputChange(e.target.name, e.target.value);
                });
            };

            const renderResult = () => {
                const parsedPlan = parsePlan(generatedPlan);
                const colors = ['bg-blue-100', 'bg-green-100', 'bg-yellow-100', 'bg-red-100', 'bg-purple-100', 'bg-pink-100'];
                const darkColors = ['dark:bg-blue-800', 'dark:bg-green-800', 'dark:bg-yellow-800', 'dark:bg-red-800', 'dark:bg-purple-800', 'dark:bg-pink-800'];

                const resultHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-4xl mx-auto p-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white text-center mb-6">Plano de Aula Gerado</h2>
                        <div id="plan-content" class="space-y-4">
                            ${parsedPlan.map((section, index) => `
                                <div class="p-6 rounded-xl ${colors[index % colors.length]} ${darkColors[index % darkColors.length]}">
                                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-3">${section.title}</h3>
                                    <div class="text-gray-700 dark:text-gray-300 whitespace-pre-line leading-relaxed">
                                        ${section.content}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex flex-wrap gap-3 justify-center mt-8">
                            <button id="copy-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                                📋 Copiar
                            </button>
                            <button id="whatsapp-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                                📱 WhatsApp
                            </button>
                            <button id="pdf-btn" class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition">
                                📄 Salvar PDF
                            </button>
                            <button id="back-btn" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 transition">
                                ↩ Voltar
                            </button>
                        </div>
                        ${copiedMessage ? '<div class="text-green-600 text-center mt-4 font-semibold">✓ Copiado para a área de transferência!</div>' : ''}
                    </div>
                `;
                appContainer.innerHTML = resultHTML;

                // Adicionar event listeners corretamente
                document.getElementById('copy-btn').onclick = handleCopy;
                document.getElementById('whatsapp-btn').onclick = handleShareWhatsApp;
                document.getElementById('pdf-btn').onclick = handleSavePdf;
                document.getElementById('back-btn').onclick = () => {
                    currentPage = 'form';
                    render();
                };
            };

            render();
        });
    </script>
</body>
</html>
